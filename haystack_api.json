{
   "swagger":"2.0",
   "info":{
      "description":"PII Leaks access API",
      "version":"1.0.0",
      "title":"Haystack API",
      "contact":{
         "email":"contact@datatransparencylab.org"
      },
      "license":{
         "name":"Apache 2.0",
         "url":"http://www.apache.org/licenses/LICENSE-2.0.html"
      }
   },
   "tags":[
      {
         "name":"authorized",
         "description":"Secured Admin-only calls"
      },
      {
         "name":"unauthorized",
         "description":"Operations available to regular developers"
      }
   ],
   "schemes":[
      "https"
   ],
   "paths":{
      "/apps":{
         "get":{
            "tags":[
               "authorized"
            ],
            "summary":"searches leaks matching the applied filters.",
            "operationId":"searchLeaker",
            "description":"By passing in the appropriate options, you can search for\navailable inventory in the system\n",
            "produces":[
               "application/json"
            ],
            "parameters":[
               {
                  "in":"query",
                  "name":"dst_port",
                  "description":"pass an optional communication destination port",
                  "required":false,
                  "type":"integer",
                  "format":"int32"
               },
               {
                  "in":"query",
                  "name":"dst_ip",
                  "description":"communication destination ip adress",
                  "type":"string"
               },
               {
                  "in":"query",
                  "name":"ip_protocol",
                  "description":"ip protocol used in the communication",
                  "type":"integer",
                  "format":"int32"
               },
               {
                  "in":"query",
                  "name":"pii_leak_type",
                  "description":"type of pii leak",
                  "type":"string",
                  "format":"int32"
               }
            ],
            "responses":{
               "200":{
                  "description":"search results matching the applied filter",
                  "schema":{
                     "type":"array",
                     "items":{
                        "$ref":"#/definitions/appInfo"
                     }
                  }
               },
               "400":{
                  "description":"bad input parameter"
               }
            }
         }
      },
      "/report/app":{
         "get":{
            "tags":[
               "authorized"
            ],
            "summary":"reports the leaks for a certain app.",
            "operationId":"appReport",
            "description":"By passing in the app info, returns a report of the ocurred leaks\n",
            "produces":[
               "application/json"
            ],
            "parameters":[
               {
                  "in":"query",
                  "name":"app_package",
                  "description":"package of the desired app",
                  "required":true,
                  "type":"string"
               },
               {
                  "in":"query",
                  "name":"app_version",
                  "description":"version of the desired app, if not used the report will containt the data for each version",
                  "type":"string"
               }
            ],
            "responses":{
               "200":{
                  "description":"search results matching the applied filter",
                  "schema":{
                     "type":"array",
                     "items":{
                        "$ref":"#/definitions/leak"
                     }
                  }
               },
               "400":{
                  "description":"bad input parameter"
               }
            }
         }
      },
      "/report/domain":{
         "get":{
            "tags":[
               "authorized"
            ],
            "summary":"reports the leaks for a certain domain.",
            "operationId":"domainReport",
            "description":"By passing in a domain info, returns a report of the ocurred leaks\n",
            "produces":[
               "application/json"
            ],
            "parameters":[
               {
                  "in":"query",
                  "name":"dst_domain",
                  "description":"destination domain of the pii",
                  "required":true,
                  "type":"string"
               }
            ],
            "responses":{
               "200":{
                  "description":"search results matching the applied filter",
                  "schema":{
                     "type":"array",
                     "items":{
                        "$ref":"#/definitions/leak"
                     }
                  }
               },
               "400":{
                  "description":"bad input parameter"
               }
            }
         }
      },
      "/insights/domain":{
         "get":{
            "tags":[
               "authorized"
            ],
            "summary":"reports the insights of the leaks for a certain domain. (total leaks and for each type)",
            "operationId":"domainInsights",
            "description":"By passing in a domain info, returns a report a resume of the differents leaks occurred\n",
            "produces":[
               "application/json"
            ],
            "parameters":[
               {
                  "in":"query",
                  "name":"dst_domain",
                  "description":"destination domain of the pii",
                  "required":true,
                  "type":"string"
               }
            ],
            "responses":{
               "200":{
                  "description":"search results matching the applied filter",
                  "schema":{
                     "$ref":"#/definitions/insights"
                  }
               },
               "400":{
                  "description":"bad input parameter"
               }
            }
         }
      },
      "/insights/app":{
         "get":{
            "tags":[
               "authorized"
            ],
            "summary":"reports the insights of the leaks for a certain app. (total leaks and for each type)",
            "operationId":"appInsights",
            "description":"By passing in an app info, returns a report a resume of the differents leaks occurred\n",
            "produces":[
               "application/json"
            ],
            "parameters":[
               {
                  "in":"query",
                  "name":"dst_domain",
                  "description":"destination domain of the pii",
                  "required":true,
                  "type":"string"
               }
            ],
            "responses":{
               "200":{
                  "description":"search results matching the applied filter",
                  "schema":{
                     "$ref":"#/definitions/insights"
                  }
               },
               "400":{
                  "description":"bad input parameter"
               }
            }
         }
      }
   },
   "definitions":{
      "appInfo":{
         "type":"object",
         "required":[
            "app_package",
            "app_name",
            "app_version"
         ],
         "properties":{
            "app_package":{
               "type":"string",
               "example":"com.facebook.android"
            },
            "app_name":{
               "type":"string",
               "example":"Facebook"
            },
            "app_version":{
               "type":"string",
               "example":"2.3"
            }
         }
      },
      "insights":{
         "type":"object",
         "required":[
            "total_leaks",
            "leak_insight_list"
         ],
         "properties":{
            "total_leaks":{
               "type":"integer",
               "example":123
            },
            "leak_insight_list":{
               "type":"array",
               "example":[
                  {
                     "leak_type":"personal_info",
                     "leak_count":"2"
                  }
               ]
            }
         }
      },
      "leak":{
         "type":"object",
         "required":[
            "app_package",
            "app_name",
            "app_version",
            "flow_start_time",
            "src_port",
            "dst_port",
            "dst_ip",
            "tls_sni",
            "sink_dns_fqdn",
            "pii_leak_type",
            "encrypted",
            "ip_protocol",
            "screen_state",
            "mcc_mnc",
            "extra_info"
         ],
         "properties":{
            "app_package":{
               "type":"string",
               "example":"com.facebook.android"
            },
            "app_name":{
               "type":"string",
               "example":"Facebook"
            },
            "app_version":{
               "type":"string",
               "example":"2.3"
            },
            "flow_start_time":{
               "type":"string",
               "example":"test"
            },
            "src_port":{
               "type":"string",
               "example":"test"
            },
            "dst_port":{
               "type":"string",
               "example":"test"
            },
            "dst_ip":{
               "type":"string",
               "example":"test"
            },
            "tls_sni":{
               "type":"string",
               "example":"test"
            },
            "sink_dns_fqdn":{
               "type":"string",
               "example":"test"
            },
            "pii_leak_type":{
               "type":"string",
               "example":"test"
            },
            "encrypted":{
               "type":"string",
               "example":"test"
            },
            "ip_protocol":{
               "type":"string",
               "example":"test"
            },
            "screen_state":{
               "type":"string",
               "example":"test"
            },
            "mcc_mnc":{
               "type":"string",
               "example":"test"
            },
            "extra_info":{
               "type":"string",
               "example":"test"
            }
         }
      }
   },
   "host":"virtserver.swaggerhub.com",
   "basePath":"/aterradas/Haystack/1.0.0"
}
